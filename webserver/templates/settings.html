{% extends "base.html" %}
{% block content %}

<main>
  <section id="settings">

    <nav class="sectionHead"><a class="back" onClick="goBack()"></a>
      <span>
        <h3>Settings</h3>
      </span>
      <select id="presets" class="presets" name="presets" onchange="loadSelectedPreset()">
        <option value="custom">Current</option>
        {% for item in pageVariables.presetsList %}
        <option value="{{ item }}" {% if pageVariables.selectedProfile == item %} selected {% endif %}}>{{ item }}
        </option>
        {% endfor %}
      </select>
      <a class="homeLink" href="/"></a>
    </nav>
    <p id="changesMade" class="warning"><img src="../static/images/icons/noun_Information_55404_a0044a.svg" />The fields
      in red are unsaved changes</p>

    <form id="settingsForm" method="post" action="/{{pageVariables.myType}}--{{pageVariables.myUID}}/saveconfig">
      <ul>

        {% for sectionName in form %}

        {% set section = form[sectionName] %}

        <span onclick="collapse(this)" class="subhead">
          <h4>{{sectionName}}</h4><img src="../static/images/icons/noun_uncollapse.svg" />
        </span>

        <div class="collapsable">
          <div class="inner">

            {% for element in section %}
            
            {% set attribute = element.key %}

            {% if element.saveLocationOverride is defined %}

            {% set attribute = attribute + "__" + element.saveLocationOverride %}

            {% endif %}
           
            {% if element["enum"] %} 
            
            {% if element["format"] == "radio" %}

            <li>
              <span>
                <label for="{{attribute}}">{{element.title}}</label>
                <span class="radios">
                  {% for option in element.enum %}
                  <span class="checkradio">
                    <input {% if element.default|string() == option|string() %} checked="checked" {% endif %}
                      type="radio" id="{{attribute}}" name="{{attribute}}" value="{{option|string()}}" />
                    <label for="{{attribute}}">{{option}}</label>
                  </span>
                  {% endfor %}
                </span>
              </span>
              <p class="description">{{element.description}}</p>
            </li>

            {% elif element["format"] == "checkbox" %}

            <li>
              <span>
                <label for="{{attribute}}">{{element.title}}</label>
                <span class="radios">
                  {% for option in element.enum %}
                  <span class="checkradio">
                    <input {% if element.default|string() == option|string() %} checked="checked" {% endif %} type="checkbox"
                      id="{{attribute}}" name="{{attribute}}" value="{{option}}" />
                    <label for="{{attribute}}">{{option}}</label>
                  </span>
                  {% endfor %}
                </span>
              </span>
              <p class="description">{{element.description}}</p>
            </li>


            {% else %}

            <li>
              <span>
                <label class="longer" for="{{attribute}}">{{element.title}}</label>
                <select autocomplete="off" id="{{attribute}}" name="{{attribute}}">
                  {% for option in element.enum %}
                  <option {% if element.default|string() == option.value|string() %} selected="selected" {% endif %}
                    value="{{option.value}}">{{option.label}}</option>
                  {% endfor %}
                </select>
                <p class="description">{{element.description}}</p>
              </span>
            </li>

            {% endif %}

            {% elif element["type"] == "string" %}

            <li>
              <span>
                <label class="shorter" for="{{attribute}}">{{element.title}}</label>
                <input {% if element.class is defined  %} class="{{element.class}}" {% endif %} name="{{attribute}}" id="{{attribute}}" type="text" value="{{element.default}}">
              </span>
              <p class="description">{{element.description}}</p>
            </li>
            {% elif element["type"] == "array" %}

            <li>
              <span>
                <label class="shorter" for="{{attribute}}">{{element.title}}</label>
                <textarea class=""  name="{{attribute}}" id="{{attribute}}" >{{element.default|join('\n')}}</textarea>
              </span>
              <p class="description">{{element.description}}</p>
            </li>

            {% elif element["type"] == "password" %}

            <li>
              <span>
                <label class="shorter" for="{{attribute}}">{{element.title}}</label>
                <input class="" name="{{attribute}}" id="{{attribute}}" type="password" value="{{element.default}}">
              </span>
              <p class="description">{{element.description}}</p>
            </li>

            {% elif element["type"] == "number" %}

            <li>
              <span>
                <label class="longer" for="{{attribute}}">{{element.title}}</label>
                <input class="shorter" name="{{attribute}}" id="{{attribute}}" type="number" value="{{element.default}}"
                  {% if element.maximum is defined  %} max="{{element.maximum}}" {% endif %}
                  {% if element.minimum is defined  %} min="{{element.minimum}}" {% endif %}>
              </span>
              <p class="description">{{element.description}}</p>
            </li>
            {% elif element["type"] == "timePastMidnight" %}
            
            <li>
              <span>
                <label class="longer" for="{{attribute}}">{{element.title}}</label>
                <input  name="{{attribute}}" id="{{attribute}}" type="time" value="{{element.default}}"
                  {% if element.maximum is defined  %} max="{{element.maximum}}" {% endif %}
                  {% if element.minimum is defined  %} min="{{element.minimum}}" {% endif %}>
              </span>
              <p class="description">{{element.description}}</p>
            </li>

            {% elif element["type"] == "time" %}
            <li>
              <div class="nativeTimePicker">
                <label for="{{attribute}}">{{element.title}} (time)</label>
                {% set timeValue = element.default|string() %}
                <input id="{{attribute}}" type="time" name="{{attribute}}" min="00:00" max="23:59"
                  value={{timeValue[0:2]}}:{{timeValue[2:4]}}>
              </div>

              <p class="description">{{element.description}}</p>
            </li>

            {% elif element["type"] == "checkbox" %}

            <li>
              <span>
                <label class="longer" for="{{attribute}}">{{element.title}}</label>
                <input {% if element.default is sameas true %} checked="checked" {% endif %} class="shorter"
                  name="{{attribute}}" id="{{attribute}}" type="checkbox" value={{element.default}}>
              </span>
              <p class="description">{{element.description}}</p>
            </li>

            {% elif element["type"] == "systemdate" %}

            <li>
              <span>
                <label class="nativeTimePicker" for="{{attribute}}">{{element.title}}</label>
                <input class="" name="{{attribute}}" type="date" value="{{deviceVariables.currentDeviceDate}}"
                  id="{{attribute}}">
              </span>
              <p class="description">{{element.description}}</p>
            </li>


            {% elif element["type"] == "systemtime" %}

            <li>
              <span>
                <label class="nativeTimePicker" for="{{attribute}}">{{element.title}}</label>
                <input class="" name="{{attribute}}" type="time" value="{{deviceVariables.currentDeviceTime}}"
                  id="{{attribute}}">
              </span>
              <p class="description">{{element.description}}</p>
            </li>

            {% elif element["type"] == "hidden" %}

            <input class="" name="{{attribute}}" id="{{attribute}}" type="hidden" value="{{element.default}}">


            {% endif %}

            {% endfor %}

          </div>
        </div>

        {% endfor %}

        <div style="clear:both;"></div>

      </ul>


      <div class="settingsActions">
        <button type="submit" id="save">Save</button>
      </div>

    </form>

  </section>
  <section>{% include "oamDetails.html" %}</section>

</main>

{% endblock %}